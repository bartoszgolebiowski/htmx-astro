---
import { getDefaultValues, clearCookies } from "../../cookiesHTMX";

const valuesFirstStep = getDefaultValues(Astro.cookies, "step1")!;
const valuesSecondStep = getDefaultValues(Astro.cookies, "step2")!;
const valuesThirdStep = getDefaultValues(Astro.cookies, "step3")!;
const firstStepAvailable = !!valuesFirstStep?.email;
const secondStepAvailable = !!valuesSecondStep?.address;
const thirdStepAvailable = !!valuesThirdStep?.cardExpiry;
const isFormFullfilled =
  firstStepAvailable && secondStepAvailable && thirdStepAvailable;

if (Astro.request.method === "POST") {
  if (isFormFullfilled) {
    clearCookies(Astro.cookies);
    return Astro.redirect("/completed", 302);
  }
}
if (!isFormFullfilled) {
  return Astro.redirect("/htmx", 302);
}
---

<button
  class=`inline-block rounded-lg p-4 cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg`
  hx-get="/htmx/step-1"
  hx-target="#content"
  hx-swap="innerHTML"
>
  First step</button
>
<pre>{JSON.stringify(valuesFirstStep,null,2)}</pre>
<button
  class=`inline-block rounded-lg p-4 cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg`
  hx-get="/htmx/step-2"
  hx-target="#content"
  hx-swap="innerHTML"
>
  Second step</button
>
<pre>{JSON.stringify(valuesSecondStep,null,2)}</pre>
<button
  class=`inline-block rounded-lg p-4 cursor-pointer bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg`
  hx-get="/htmx/step-3"
  hx-target="#content"
  hx-swap="innerHTML"
>
  Third step</button
>
<pre>{JSON.stringify(valuesThirdStep,null,2)}</pre>
<form hx-post="/htmx/summary" hx-target="#content" method="POST">
  <button
    type="submit"
    class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"
    >Submit</button
  >
</form>
